# æ–°éƒ½æ¡¥æ—…è¡Œç½‘ç«™ Docker éƒ¨ç½²é…ç½®æ€»ç»“

## ğŸ“ é¡¹ç›®ç»“æ„

```
318/
â”œâ”€â”€ ğŸ“„ Dockerfile                    # ä¸» Dockerfile
â”œâ”€â”€ ğŸ“„ docker-compose.yml           # åŸºç¡€ Docker Compose é…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose.dev.yml       # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose.prod.yml      # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ ğŸ“„ nginx.conf                   # åŸºç¡€ Nginx é…ç½®
â”œâ”€â”€ ğŸ“„ default.conf                 # åŸºç¡€ç«™ç‚¹é…ç½®
â”œâ”€â”€ ğŸ“„ .dockerignore                # Docker å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ Makefile                     # ä¾¿æ·ç®¡ç†å‘½ä»¤
â”œâ”€â”€ ğŸ“„ deploy.sh                    # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ ğŸ“„ env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ ğŸ“„ DOCKER_DEPLOYMENT.md         # è¯¦ç»†éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ ğŸ“„ DOCKER_SUMMARY.md            # æœ¬æ–‡ä»¶
â”œâ”€â”€ ğŸ“ config/                      # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ nginx.dev.conf           # å¼€å‘ç¯å¢ƒ Nginx é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ nginx.prod.conf          # ç”Ÿäº§ç¯å¢ƒ Nginx é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ default.dev.conf         # å¼€å‘ç¯å¢ƒç«™ç‚¹é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ default.prod.conf        # ç”Ÿäº§ç¯å¢ƒç«™ç‚¹é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ proxy.conf               # åå‘ä»£ç†é…ç½®
â”‚   â””â”€â”€ ğŸ“„ filebeat.yml             # æ—¥å¿—æ”¶é›†é…ç½®
â””â”€â”€ ğŸ“ logs/                        # æ—¥å¿—ç›®å½•
    â””â”€â”€ ğŸ“ nginx/                   # Nginx æ—¥å¿—ç›®å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€éƒ¨ç½²
```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy.sh start

# æˆ–ä½¿ç”¨ Makefile
make build && make start

# æˆ–ä½¿ç”¨ Docker Compose
docker-compose up -d
```

### 2. ç¯å¢ƒç‰¹å®šéƒ¨ç½²
```bash
# å¼€å‘ç¯å¢ƒ
make dev
# æˆ–
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d

# ç”Ÿäº§ç¯å¢ƒ
make prod
# æˆ–
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

## ğŸ“‹ é…ç½®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `Dockerfile` | å®¹å™¨é•œåƒæ„å»º | åŸºäº Nginx Alpineï¼ŒåŒ…å«å®‰å…¨é…ç½®å’Œä¼˜åŒ– |
| `docker-compose.yml` | åŸºç¡€æœåŠ¡é…ç½® | å®šä¹‰ä¸»æœåŠ¡ã€ç½‘ç»œå’Œå· |
| `nginx.conf` | Nginx ä¸»é…ç½® | åŸºç¡€æ€§èƒ½å’Œå®‰å…¨é…ç½® |
| `default.conf` | ç«™ç‚¹é…ç½® | åŸºç¡€è·¯ç”±å’Œç¼“å­˜ç­–ç•¥ |

### ç¯å¢ƒç‰¹å®šé…ç½®

| æ–‡ä»¶ | ç¯å¢ƒ | ç‰¹ç‚¹ |
|------|------|------|
| `docker-compose.dev.yml` | å¼€å‘ | ç«¯å£3000ï¼Œçƒ­é‡è½½ï¼Œè¯¦ç»†æ—¥å¿— |
| `docker-compose.prod.yml` | ç”Ÿäº§ | èµ„æºé™åˆ¶ï¼Œç›‘æ§ï¼Œæ—¥å¿—æ”¶é›† |
| `nginx.dev.conf` | å¼€å‘ | å•è¿›ç¨‹ï¼Œè°ƒè¯•æ—¥å¿—ï¼ŒçŸ­ç¼“å­˜ |
| `nginx.prod.conf` | ç”Ÿäº§ | å¤šè¿›ç¨‹ï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œå®‰å…¨å¤´ |

### æ‰©å±•é…ç½®

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `config/proxy.conf` | åå‘ä»£ç† | è´Ÿè½½å‡è¡¡é…ç½®ç¤ºä¾‹ |
| `config/filebeat.yml` | æ—¥å¿—æ”¶é›† | ELK æ ˆé›†æˆé…ç½® |
| `Makefile` | ç®¡ç†å‘½ä»¤ | ä¾¿æ·çš„éƒ¨ç½²å’Œç®¡ç†å‘½ä»¤ |
| `deploy.sh` | éƒ¨ç½²è„šæœ¬ | è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ |

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### ä½¿ç”¨ Makefile
```bash
make help          # æ˜¾ç¤ºå¸®åŠ©
make build         # æ„å»ºé•œåƒ
make start         # å¯åŠ¨æœåŠ¡
make stop          # åœæ­¢æœåŠ¡
make restart       # é‡å¯æœåŠ¡
make status        # æŸ¥çœ‹çŠ¶æ€
make logs          # æŸ¥çœ‹æ—¥å¿—
make health        # å¥åº·æ£€æŸ¥
make test          # è¿è¡Œæµ‹è¯•
make clean         # æ¸…ç†èµ„æº
```

### ä½¿ç”¨éƒ¨ç½²è„šæœ¬
```bash
./deploy.sh start              # å¯åŠ¨åŸºç¡€æœåŠ¡
./deploy.sh start monitoring   # å¯åŠ¨å¹¶å¯ç”¨ç›‘æ§
./deploy.sh logs               # æŸ¥çœ‹æ—¥å¿—
./deploy.sh status             # æŸ¥çœ‹çŠ¶æ€
./deploy.sh health             # å¥åº·æ£€æŸ¥
```

### ä½¿ç”¨ Docker Compose
```bash
# åŸºç¡€æ“ä½œ
docker-compose up -d           # å¯åŠ¨æœåŠ¡
docker-compose down            # åœæ­¢æœåŠ¡
docker-compose restart         # é‡å¯æœåŠ¡
docker-compose ps              # æŸ¥çœ‹çŠ¶æ€
docker-compose logs -f         # æŸ¥çœ‹æ—¥å¿—

# ç¯å¢ƒç‰¹å®š
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

## ğŸ”§ é…ç½®ç‰¹æ€§

### å®‰å…¨ç‰¹æ€§
- âœ… é root ç”¨æˆ·è¿è¡Œ
- âœ… å®‰å…¨å¤´é…ç½®
- âœ… æ–‡ä»¶è®¿é—®é™åˆ¶
- âœ… è¯·æ±‚å¤§å°é™åˆ¶
- âœ… è¶…æ—¶é…ç½®

### æ€§èƒ½ä¼˜åŒ–
- âœ… Gzip å‹ç¼©
- âœ… é™æ€èµ„æºç¼“å­˜
- âœ… è¿æ¥æ± ä¼˜åŒ–
- âœ… å·¥ä½œè¿›ç¨‹ä¼˜åŒ–
- âœ… ç¼“å†²åŒºé…ç½®

### ç›‘æ§å’Œæ—¥å¿—
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… Nginx çŠ¶æ€é¡µé¢
- âœ… ç»“æ„åŒ–æ—¥å¿—
- âœ… æ—¥å¿—è½®è½¬
- âœ… Prometheus æŒ‡æ ‡

### å¼€å‘å‹å¥½
- âœ… çƒ­é‡è½½æ”¯æŒ
- âœ… è¯¦ç»†è°ƒè¯•æ—¥å¿—
- âœ… å¼€å‘å·¥å…·é›†æˆ
- âœ… ä¾¿æ·ç®¡ç†å‘½ä»¤

## ğŸŒ è®¿é—®åœ°å€

### åŸºç¡€æœåŠ¡
- **ä¸»ç½‘ç«™**: http://localhost
- **å¥åº·æ£€æŸ¥**: http://localhost/health
- **Nginx çŠ¶æ€**: http://localhost/nginx_status

### å¼€å‘ç¯å¢ƒ
- **ä¸»ç½‘ç«™**: http://localhost:3000
- **å¼€å‘å·¥å…·**: http://localhost:8080

### ç›‘æ§æœåŠ¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- **Prometheus æŒ‡æ ‡**: http://localhost:9113/metrics

## ğŸ“Š æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¯·æ±‚      â”‚â”€â”€â”€â–¶â”‚   Nginx åå‘ä»£ç† â”‚â”€â”€â”€â–¶â”‚   é™æ€ç½‘ç«™      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   ç›‘æ§æœåŠ¡      â”‚
                       â”‚ (Prometheus)    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   æ—¥å¿—æ”¶é›†      â”‚
                       â”‚ (Filebeat)      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :80
   
   # ä¿®æ”¹ç«¯å£æ˜ å°„
   # ç¼–è¾‘ docker-compose.yml ä¸­çš„ ports é…ç½®
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # ä¿®å¤æ—¥å¿—ç›®å½•æƒé™
   sudo chown -R $USER:$USER logs/
   ```

3. **å®¹å™¨æ— æ³•å¯åŠ¨**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   docker-compose logs xinduqiao-travel
   
   # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
   docker run --rm -v $(pwd)/nginx.conf:/etc/nginx/nginx.conf nginx:alpine nginx -t
   ```

### è°ƒè¯•å‘½ä»¤

```bash
# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it xinduqiao-travel-website sh

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats xinduqiao-travel-website

# æŸ¥çœ‹ç½‘ç»œé…ç½®
docker network ls
docker network inspect xinduqiao-travel-network
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### åŸºç¡€ç›‘æ§
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
make status

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# å¥åº·æ£€æŸ¥
make health
```

### é«˜çº§ç›‘æ§ï¼ˆéœ€è¦å¯ç”¨ monitoring profileï¼‰
```bash
# å¯åŠ¨ç›‘æ§æœåŠ¡
docker-compose --profile monitoring up -d

# æŸ¥çœ‹ Prometheus æŒ‡æ ‡
curl http://localhost:9113/metrics
```

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### æ›´æ–°é•œåƒ
```bash
# ä½¿ç”¨ Makefile
make update

# æ‰‹åŠ¨æ›´æ–°
docker-compose pull
docker-compose up -d
```

### å¤‡ä»½é…ç½®
```bash
# ä½¿ç”¨ Makefile
make backup

# æ‰‹åŠ¨å¤‡ä»½
cp -r config backups/$(date +%Y%m%d_%H%M%S)/
```

### æ¸…ç†èµ„æº
```bash
# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
make clean

# æ¸…ç†æ‰€æœ‰èµ„æº
make clean-all
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. `DOCKER_DEPLOYMENT.md` - è¯¦ç»†éƒ¨ç½²æŒ‡å—
2. `Makefile` - ç®¡ç†å‘½ä»¤è¯´æ˜
3. `deploy.sh --help` - éƒ¨ç½²è„šæœ¬å¸®åŠ©

---

**æ³¨æ„**: æœ¬é…ç½®å·²é’ˆå¯¹æ–°éƒ½æ¡¥æ—…è¡Œç½‘ç«™è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒåŒ…å«å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒé…ç½®ã€å¼€å‘ç¯å¢ƒæ”¯æŒå’Œç›‘æ§é›†æˆã€‚è¯·æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹å¼ã€‚
