# ğŸŒ ä¸­æ™‹æ•°æ®ç§‘æŠ€ - å¤–ç½‘åŸŸåéƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [åŸŸåé…ç½®](#åŸŸåé…ç½®)
- [SSLè¯ä¹¦é…ç½®](#sslè¯ä¹¦é…ç½®)
- [éƒ¨ç½²æ–¹å¼](#éƒ¨ç½²æ–¹å¼)
- [è®¿é—®æµ‹è¯•](#è®¿é—®æµ‹è¯•)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [å®‰å…¨é…ç½®](#å®‰å…¨é…ç½®)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸŸåä¿¡æ¯
- **å¤–ç½‘åŸŸå**: `dt.yongli.wang`
- **è®¿é—®åœ°å€**: `https://dt.yongli.wang`
- **æœ¬åœ°æµ‹è¯•**: `http://localhost`

### ä¸€é”®éƒ¨ç½²

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/wkdays/datarecover.git
cd datarecover

# å¤–ç½‘åŸŸåéƒ¨ç½²
./deploy-domain.sh manual
```

### Docker Composeéƒ¨ç½²

```bash
# ä½¿ç”¨Composeéƒ¨ç½²
./deploy-domain.sh compose
```

---

## ğŸŒ åŸŸåé…ç½®

### 1. DNSè§£æé…ç½®

ç¡®ä¿åŸŸå `dt.yongli.wang` å·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨IPï¼š

```bash
# æ£€æŸ¥åŸŸåè§£æ
nslookup dt.yongli.wang
dig dt.yongli.wang

# æˆ–ä½¿ç”¨åœ¨çº¿å·¥å…·
# https://www.whatsmydns.net/
```

### 2. æœåŠ¡å™¨è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu/CentOS/Debian)
- **Docker**: 20.10+
- **Docker Compose**: 1.29+
- **ç«¯å£**: 80, 443 (å¼€æ”¾é˜²ç«å¢™)

### 3. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian
sudo ufw allow 80
sudo ufw allow 443
sudo ufw reload

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --reload
```

---

## ğŸ”’ SSLè¯ä¹¦é…ç½®

### æ–¹å¼ä¸€ï¼šè‡ªç­¾åè¯ä¹¦ï¼ˆæµ‹è¯•ç”¨ï¼‰

```bash
# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
./ssl-setup.sh self

# æˆ–æ‰‹åŠ¨ç”Ÿæˆ
mkdir -p proxy/ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout proxy/ssl/key.pem \
    -out proxy/ssl/cert.pem \
    -subj "/C=CN/ST=Shanghai/L=Shanghai/O=ä¸­æ™‹æ•°æ®ç§‘æŠ€/CN=dt.yongli.wang"
```

### æ–¹å¼äºŒï¼šLet's Encryptè¯ä¹¦ï¼ˆæ¨èï¼‰

```bash
# å®‰è£…Certbot
sudo apt-get install certbot  # Ubuntu/Debian
sudo yum install certbot     # CentOS/RHEL

# ç”ŸæˆLet's Encryptè¯ä¹¦
./ssl-setup.sh letsencrypt
```

### æ–¹å¼ä¸‰ï¼šè´­ä¹°å•†ä¸šè¯ä¹¦

1. è´­ä¹°SSLè¯ä¹¦
2. å°†è¯ä¹¦æ–‡ä»¶æ”¾ç½®åˆ° `proxy/ssl/` ç›®å½•
3. é‡å‘½åä¸º `cert.pem` å’Œ `key.pem`

---

## ğŸ³ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# å®Œæ•´éƒ¨ç½²æµç¨‹
./deploy-domain.sh manual
```

**æ‰§è¡Œæ­¥éª¤**:
1. âœ… æ£€æŸ¥Dockerç¯å¢ƒ
2. âœ… ä¿æŠ¤ç°æœ‰é•œåƒ
3. âœ… é…ç½®SSLè¯ä¹¦
4. âœ… æ„å»ºç½‘ç«™é•œåƒ
5. âœ… å¯åŠ¨ç½‘ç«™æœåŠ¡
6. âœ… å¯åŠ¨åå‘ä»£ç†
7. âœ… å¥åº·æ£€æŸ¥

### æ–¹å¼äºŒï¼šDocker Composeéƒ¨ç½²

```bash
# ä½¿ç”¨Composeéƒ¨ç½²
./deploy-domain.sh compose
```

**é…ç½®æ–‡ä»¶**: `docker-compose.yml`

### æ–¹å¼ä¸‰ï¼šåˆ†æ­¥éƒ¨ç½²

```bash
# ä»…é…ç½®SSL
./deploy-domain.sh ssl

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy-domain.sh status

# æŸ¥çœ‹æ—¥å¿—
./deploy-domain.sh logs
```

---

## ğŸ” è®¿é—®æµ‹è¯•

### 1. æœ¬åœ°æµ‹è¯•

```bash
# æµ‹è¯•ç½‘ç«™æœåŠ¡
curl http://localhost:8080

# æµ‹è¯•ä»£ç†æœåŠ¡
curl http://localhost

# æµ‹è¯•HTTPS
curl -k https://localhost
```

### 2. å¤–ç½‘æµ‹è¯•

```bash
# æµ‹è¯•åŸŸåè§£æ
curl https://dt.yongli.wang

# æµ‹è¯•HTTPé‡å®šå‘
curl -I http://dt.yongli.wang
# åº”è¯¥è¿”å› 301 é‡å®šå‘åˆ° HTTPS
```

### 3. æµè§ˆå™¨æµ‹è¯•

1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—® `https://dt.yongli.wang`
3. æ£€æŸ¥SSLè¯ä¹¦çŠ¶æ€
4. æµ‹è¯•ç½‘ç«™åŠŸèƒ½

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åŸŸåæ— æ³•è®¿é—®

```bash
# æ£€æŸ¥DNSè§£æ
nslookup dt.yongli.wang

# æ£€æŸ¥æœåŠ¡å™¨è¿é€šæ€§
ping dt.yongli.wang

# æ£€æŸ¥ç«¯å£å¼€æ”¾
telnet dt.yongli.wang 80
telnet dt.yongli.wang 443
```

#### 2. SSLè¯ä¹¦é—®é¢˜

```bash
# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶
ls -la proxy/ssl/

# éªŒè¯è¯ä¹¦
openssl x509 -in proxy/ssl/cert.pem -text -noout

# æ£€æŸ¥è¯ä¹¦å’Œç§é’¥åŒ¹é…
openssl x509 -noout -modulus -in proxy/ssl/cert.pem | openssl md5
openssl rsa -noout -modulus -in proxy/ssl/key.pem | openssl md5
```

#### 3. å®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs zhongjin-datarecover
docker logs datarecover-proxy

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a

# é‡å¯æœåŠ¡
./deploy-domain.sh restart
```

#### 4. ç«¯å£å†²çª

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep -E ":80|:443"

# åœæ­¢å†²çªæœåŠ¡
sudo systemctl stop apache2  # å¦‚æœApacheå ç”¨80ç«¯å£
sudo systemctl stop nginx    # å¦‚æœNginxå ç”¨80ç«¯å£
```

### è°ƒè¯•å‘½ä»¤

```bash
# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it zhongjin-datarecover sh
docker exec -it datarecover-proxy sh

# æ£€æŸ¥Nginxé…ç½®
docker exec datarecover-proxy nginx -t

# é‡æ–°åŠ è½½Nginxé…ç½®
docker exec datarecover-proxy nginx -s reload
```

---

## ğŸ” å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™é…ç½®

```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

### 2. SSLå®‰å…¨é…ç½®

```nginx
# nginx.conf ä¸­å·²é…ç½®çš„å®‰å…¨å¤´
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
```

### 3. å®¹å™¨å®‰å…¨

```bash
# ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
USER nginx

# é™åˆ¶å®¹å™¨èµ„æº
docker run --memory=512m --cpus=1.0 ...
```

---

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### 1. æœåŠ¡ç›‘æ§

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy-domain.sh status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
./deploy-domain.sh logs

# ç›‘æ§èµ„æºä½¿ç”¨
docker stats
```

### 2. æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹ç½‘ç«™æ—¥å¿—
docker logs -f zhongjin-datarecover

# æŸ¥çœ‹ä»£ç†æ—¥å¿—
docker logs -f datarecover-proxy

# æ¸…ç†æ—§æ—¥å¿—
docker system prune -f
```

### 3. è¯ä¹¦æ›´æ–°

```bash
# Let's Encryptè¯ä¹¦è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 2 * * * /path/to/ssl-setup.sh letsencrypt

# æ‰‹åŠ¨æ›´æ–°è¯ä¹¦
./ssl-setup.sh letsencrypt
docker restart datarecover-proxy
```

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

### 1. æ€§èƒ½ä¼˜åŒ–

```yaml
# docker-compose.yml ä¸­æ·»åŠ èµ„æºé™åˆ¶
services:
  datarecover-web:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
```

### 2. è´Ÿè½½å‡è¡¡

```bash
# å¤šå®ä¾‹éƒ¨ç½²
docker-compose up -d --scale datarecover-web=3
```

### 3. é«˜å¯ç”¨é…ç½®

```bash
# ä½¿ç”¨Docker Swarm
docker swarm init
docker stack deploy -c docker-compose.yml datarecover
```

---

## ğŸ“ éƒ¨ç½²è„šæœ¬ä½¿ç”¨

### å¯ç”¨å‘½ä»¤

```bash
./deploy-domain.sh [é€‰é¡¹]
```

| å‘½ä»¤ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `manual` | æ‰‹åŠ¨éƒ¨ç½² | é€æ­¥æ‰§è¡Œéƒ¨ç½²ï¼ˆé»˜è®¤ï¼‰ |
| `compose` | Composeéƒ¨ç½² | ä½¿ç”¨docker-compose |
| `ssl` | SSLé…ç½® | ä»…é…ç½®SSLè¯ä¹¦ |
| `stop` | åœæ­¢æœåŠ¡ | åœæ­¢æ‰€æœ‰æœåŠ¡ |
| `restart` | é‡å¯æœåŠ¡ | é‡å¯æ‰€æœ‰æœåŠ¡ |
| `logs` | æŸ¥çœ‹æ—¥å¿— | æŸ¥çœ‹æ‰€æœ‰æ—¥å¿— |
| `status` | æŸ¥çœ‹çŠ¶æ€ | æŸ¥çœ‹æœåŠ¡çŠ¶æ€ |
| `clean` | æ¸…ç†èµ„æº | åˆ é™¤æ‰€æœ‰èµ„æº |
| `help` | å¸®åŠ©ä¿¡æ¯ | æ˜¾ç¤ºä½¿ç”¨è¯´æ˜ |

### ä½¿ç”¨ç¤ºä¾‹

```bash
# å®Œæ•´éƒ¨ç½²
./deploy-domain.sh manual

# ä½¿ç”¨Composeéƒ¨ç½²
./deploy-domain.sh compose

# ä»…é…ç½®SSL
./deploy-domain.sh ssl

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy-domain.sh status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
./deploy-domain.sh logs

# é‡å¯æœåŠ¡
./deploy-domain.sh restart

# æ¸…ç†èµ„æº
./deploy-domain.sh clean
```

---

## ğŸŒ è®¿é—®åœ°å€

### éƒ¨ç½²æˆåŠŸåè®¿é—®ï¼š

- **å¤–ç½‘è®¿é—®**: https://dt.yongli.wang
- **æœ¬åœ°è®¿é—®**: http://localhost
- **ç›´æ¥è®¿é—®**: http://localhost:8080
- **å¥åº·æ£€æŸ¥**: https://dt.yongli.wang/health

### ç®¡ç†åœ°å€ï¼š

- **å®¹å™¨ç®¡ç†**: `docker ps`
- **æ—¥å¿—æŸ¥çœ‹**: `./deploy-domain.sh logs`
- **çŠ¶æ€æ£€æŸ¥**: `./deploy-domain.sh status`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼

- ğŸ“§ é‚®ç®±: service@zhongjindata.com
- ğŸ“ çƒ­çº¿: 400-668-7788
- ğŸŒ å®˜ç½‘: https://wkdays.github.io/datarecover/

### é—®é¢˜åé¦ˆ

1. æ£€æŸ¥åŸŸåè§£æ: `nslookup dt.yongli.wang`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€: `./deploy-domain.sh status`
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—: `./deploy-domain.sh logs`
4. é‡å¯æœåŠ¡: `./deploy-domain.sh restart`
5. è”ç³»æŠ€æœ¯æ”¯æŒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Dockeréƒ¨ç½²æŒ‡å—.md](./Dockeréƒ¨ç½²æŒ‡å—.md) - Dockerå®¹å™¨åŒ–éƒ¨ç½²
- [ä½¿ç”¨æŒ‡å—.md](./ä½¿ç”¨æŒ‡å—.md) - ç½‘ç«™ä½¿ç”¨è¯´æ˜
- [é—­ç¯æµç¨‹è¯´æ˜.md](./é—­ç¯æµç¨‹è¯´æ˜.md) - æŠ€æœ¯æµç¨‹æ–‡æ¡£
- [å¯¼èˆªåŠŸèƒ½è¯´æ˜.md](./å¯¼èˆªåŠŸèƒ½è¯´æ˜.md) - å¯¼èˆªæŠ€æœ¯åˆ†æ
- [é¡¹ç›®æ€»ç»“.md](./é¡¹ç›®æ€»ç»“.md) - å®Œæ•´é¡¹ç›®æ€»ç»“

---

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] åŸŸå `dt.yongli.wang` å·²è§£æåˆ°æœåŠ¡å™¨IP
- [ ] æœåŠ¡å™¨é˜²ç«å¢™å·²å¼€æ”¾80/443ç«¯å£
- [ ] Dockerå’ŒDocker Composeå·²å®‰è£…
- [ ] æœåŠ¡å™¨æœ‰è¶³å¤Ÿèµ„æºï¼ˆ1GBå†…å­˜ï¼Œ1æ ¸CPUï¼‰

### éƒ¨ç½²åæ£€æŸ¥

- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—® https://dt.yongli.wang
- [ ] SSLè¯ä¹¦æ˜¾ç¤ºæ­£å¸¸ï¼ˆç»¿è‰²é”å›¾æ ‡ï¼‰
- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯

### å®‰å…¨æ£€æŸ¥

- [ ] ä½¿ç”¨HTTPSè®¿é—®
- [ ] SSLè¯ä¹¦æœ‰æ•ˆ
- [ ] é˜²ç«å¢™é…ç½®æ­£ç¡®
- [ ] å®¹å™¨ä»¥érootç”¨æˆ·è¿è¡Œ

---

**ğŸ‰ æ­å–œï¼æ‚¨çš„å¤–ç½‘åŸŸåéƒ¨ç½²å·²å®Œæˆï¼**

**è®¿é—®åœ°å€**: https://dt.yongli.wang  
**ç®¡ç†å‘½ä»¤**: `./deploy-domain.sh help`

---

Â© 2024 ä¸­æ™‹æ•°æ®ç§‘æŠ€æœ‰é™å…¬å¸


